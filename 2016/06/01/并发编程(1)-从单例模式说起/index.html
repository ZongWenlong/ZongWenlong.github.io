<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>并发编程(1)-单例模式和volatile | All is well</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">并发编程(1)-单例模式和volatile</h1><a id="logo" href="/.">All is well</a><p class="description">Learn &amp; Cope</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tools/"><i class="fa fa-cog"> 工具</i></a><a href="/future/"><i class="fa fa-heart"> 未来</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">并发编程(1)-单例模式和volatile</h1><div class="post-meta">Jun 1, 2016<span> | </span><span class="category"><a href="/categories/Technology/">Technology</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/06/01/并发编程(1)-从单例模式说起/" href="/2016/06/01/并发编程(1)-从单例模式说起/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#痛苦的回顾"><span class="toc-number">1.</span> <span class="toc-text">痛苦的回顾</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#问题的解决"><span class="toc-number">2.</span> <span class="toc-text">问题的解决</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#问题的由来"><span class="toc-number">2.1.</span> <span class="toc-text">问题的由来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Volatile"><span class="toc-number">2.2.</span> <span class="toc-text">Volatile</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Other-Way"><span class="toc-number">3.</span> <span class="toc-text">Other Way?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Eager-initialization"><span class="toc-number">3.1.</span> <span class="toc-text">Eager initialization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Initialization-on-demand-holder-idiom"><span class="toc-number">3.2.</span> <span class="toc-text">Initialization-on-demand holder idiom</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-enum-way"><span class="toc-number">3.3.</span> <span class="toc-text">The enum way</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考文献"><span class="toc-number">4.</span> <span class="toc-text">参考文献</span></a></li></ol></div></div><div class="post-content"><p>&#x2003;&#x2003;&#x4E4B;&#x524D;&#x5728;&#x627E;&#x5B9E;&#x4E60;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x88AB;N&#x6B21;&#x95EE;&#x8FC7;&#xFF0C;&#x4F60;&#x7528;&#x8FC7;&#x4EC0;&#x4E48;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x4E48;&#xFF0C;&#x6216;&#x8005;&#x4F60;&#x77E5;&#x9053;&#x6709;&#x4EC0;&#x4E48;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x4E48;&#xFF1F;&#x6BCF;&#x6B21;&#x6211;&#x90FD;&#x53EA;&#x4F1A;&#x7F9E;&#x6127;&#x7684;&#x8BF4;&#xFF0C;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF0C;&#x9762;&#x8BD5;&#x5B98;&#x5C31;&#x4F1A;&#x8BF4;&#xFF0C;&#x90A3;&#x5C31;&#x5199;&#x4E00;&#x4E0B;&#x5427;&#x3002;&#x7136;&#x540E;&#x6211;&#x5C31;&#x628A;&#x76F4;&#x63A5;&#x80CC;&#x8BF5;&#x8FC7;&#x5F97;&#x6A21;&#x677F;&#x7684;&#x5199;&#x4E86;&#x51FA;&#x6765;&#x3002;&#x5F53;&#x65F6;&#x7F9E;&#x6127;&#x7684;&#x539F;&#x56E0;&#x662F;&#x6211;&#x53EA;&#x4F1A;&#x4E00;&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x2014;&#x2014;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x3002;&#x5173;&#x4E8E;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x8FD9;&#x4E2A;&#x5751;&#x4F1A;&#x5728;&#x4E4B;&#x540E;&#x8FDB;&#x884C;&#x586B;&#x8865;&#xFF0C;&#x73B0;&#x5728;&#x7684;&#x6211;&#x624D;&#x610F;&#x8BC6;&#x5230;&#x8FD8;&#x6709;&#x4E2A;&#x5730;&#x65B9;&#x66F4;&#x5E94;&#x8BE5;&#x611F;&#x5230;&#x7F9E;&#x6127;&#x2014;&#x2014;&#x552F;&#x4E00;&#x770B;&#x8FC7;&#x7684;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x8FD8;&#x5199;&#x7684;&#x6709;&#x95EE;&#x9898;&#x3002;</p>
<h1 id="&#x75DB;&#x82E6;&#x7684;&#x56DE;&#x987E;"><a href="#&#x75DB;&#x82E6;&#x7684;&#x56DE;&#x987E;" class="headerlink" title="&#x75DB;&#x82E6;&#x7684;&#x56DE;&#x987E;"></a>&#x75DB;&#x82E6;&#x7684;&#x56DE;&#x987E;</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>{}</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class){</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>){</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x8FD9;&#x662F;&#x6211;&#x4E4B;&#x524D;&#x9762;&#x8BD5;&#x65F6;&#x5199;&#x8FC7;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8BB0;&#x5F97;&#x5F53;&#x65F6;&#x8FD8;&#x6709;&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#x8FC7;&#x6211;&#x8FD9;&#x6837;&#x5199;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF0C;&#x751A;&#x81F3;&#x4ED6;&#x8FD8;&#x5728;&#x63D0;&#x793A;&#x6211;&#xFF0C;&#x591A;&#x7EBF;&#x7A0B;&#x4E0B;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;&#x6211;&#x4FE1;&#x8A93;&#x65E6;&#x65E6;&#x7684;&#x89C9;&#x5F97;&#x53CD;&#x6B63;&#x52A0;&#x4E86;synchronized&#x4E86;&#xFF0C;&#x5C31;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x4E8B;&#x5B9E;&#x8BC1;&#x660E;&#xFF0C;&#x6211;&#x662F;too young, too simple&#xFF01;</p>
<h1 id="&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;"><a href="#&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;" class="headerlink" title="&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;"></a>&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>{}</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class){</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>){</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728;&#x4E3A;&#x6210;&#x5458;&#x53D8;&#x91CF;singleton&#x6DFB;&#x52A0;volatile&#x5173;&#x952E;&#x5B57;&#x8FDB;&#x884C;&#x4FEE;&#x9970;&#xFF0C;&#x539F;&#x672C;&#x7684;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x5C31;&#x4F1A;&#x88AB;&#x89E3;&#x51B3;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>
<h2 id="&#x95EE;&#x9898;&#x7684;&#x7531;&#x6765;"><a href="#&#x95EE;&#x9898;&#x7684;&#x7531;&#x6765;" class="headerlink" title="&#x95EE;&#x9898;&#x7684;&#x7531;&#x6765;"></a>&#x95EE;&#x9898;&#x7684;&#x7531;&#x6765;</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>{}</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>){           <span class="comment">//Point1: &#x7EBF;&#x7A0B;A</span></span><br><span class="line">            instance = <span class="keyword">new</span> Singleton(); <span class="comment">//Point2: &#x7EBF;&#x7A0B;B</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x5927;&#x5BB6;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x80FD;&#x660E;&#x767D;&#xFF0C;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x5355;&#x4F8B;&#x662F;&#x5B58;&#x5728;&#x95EE;&#x9898;&#x7684;&#x3002;&#x6BD4;&#x5982;&#xFF1A;&#x5047;&#x8BBE;&#x7EBF;&#x7A0B;A&#x6267;&#x884C;&#x5230;Point1&#xFF0C;&#x7EBF;&#x7A0B;B&#x6267;&#x884C;&#x5230;Point2&#xFF0C;&#x90A3;&#x4E48;&#x7EBF;&#x7A0B;A&#x53EF;&#x80FD;&#x770B;&#x5230;&#x8FD8;&#x672A;&#x88AB;&#x7EBF;&#x7A0B;B&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6BD5;&#x7684;singleton&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x3002;<br>&#x5BF9;&#x4E8E;instance = new Singleton();&#x8FD9;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x5927;&#x81F4;&#x5206;&#x89E3;&#x4E3A;&#x4E09;&#x6B65;:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">memory = allocate();   <span class="comment">//1&#xFF1A;&#x5206;&#x914D;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</span></span><br><span class="line">initObject(memory);    <span class="comment">//2&#xFF1A;&#x521D;&#x59CB;&#x5316;&#x5BF9;&#x8C61;</span></span><br><span class="line">instance = memory;     <span class="comment">//3&#xFF1A;&#x8BBE;&#x7F6E;instance&#x6307;&#x5411;&#x521A;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7EBF;&#x7A0B;B&#x53EF;&#x80FD;&#x6B63;&#x5728;&#x521D;&#x59CB;&#x5316;instance&#xFF0C;&#x7EBF;&#x7A0B;A&#x5C31;&#x5F97;&#x5230;&#x4E86;&#x7A7A;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x5F00;&#x59CB;&#x4E86;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x8FD9;&#x5F53;&#x7136;&#x662F;&#x8FDD;&#x80CC;&#x5355;&#x4F8B;&#x7684;&#x601D;&#x60F3;&#x7684;&#x3002;&#x90A3;&#x662F;&#x4E0D;&#x662F;&#x50CF;&#x6211;&#x5728;&#x5F00;&#x59CB;&#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x52A0;&#x5165;synchronized&#x540C;&#x6B65;&#x5757;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x5462;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5728;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#x3002;<br>&#x2003;&#x2003;&#x5176;&#x5B9E;&#xFF0C;&#x8FD9;&#x4E09;&#x6761;&#x8BED;&#x53E5;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;1,2,3&#x987A;&#x5E8F;&#x6267;&#x884C;&#xFF0C;&#x7531;&#x4E8E;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x987A;&#x5E8F;&#x53EF;&#x80FD;&#x53D8;&#x4E3A;1,3,2&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x3002;&#x5982;&#x679C;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x95EE;&#x9898;&#x5C31;&#x4E25;&#x91CD;&#x4E86;&#x3002;&#x7EBF;&#x7A0B;B&#x8FD8;&#x6CA1;&#x6709;&#x521D;&#x59CB;&#x5316;instance&#xFF0C;&#x7EBF;&#x7A0B;A&#x5C31;&#x53EF;&#x4EE5;&#x518D;&#x4E0D;&#x8FDB;&#x5165;&#x540C;&#x6B65;&#x5757;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x5F97;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x975E;&#x7A7A;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x53BB;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x8FD9;&#x663E;&#x7136;&#x662F;&#x6709;&#x95EE;&#x9898;&#x7684;&#x3002;</p>
<h2 id="Volatile"><a href="#Volatile" class="headerlink" title="Volatile"></a>Volatile</h2><p>&#x4E3A;&#x4EC0;&#x4E48;&#x52A0;&#x4E0A;volatile&#x540E;&#x95EE;&#x9898;&#x5C31;&#x4E0D;&#x5B58;&#x5728;&#x4E86;&#x5462;&#xFF1F;<br>volatile&#x5728;Java&#x4E2D;&#x7684;&#x4FDD;&#x8BC1;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x4FDD;&#x8BC1;&#x4E86;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x5BF9;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#x7684;&#x53EF;&#x89C1;&#x6027;&#xFF0C;&#x5373;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;&#x4E86;&#x67D0;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x65B0;&#x503C;&#x5BF9;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6765;&#x8BF4;&#x662F;&#x7ACB;&#x5373;&#x53EF;&#x89C1;&#x7684;&#x3002;&#x5BF9;volatile&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7684;&#x8BFB;&#x548C;&#x5199;&#x90FD;&#x662F;&#x539F;&#x5B50;&#x7684;&#x3002;&#x4E0D;&#x4F1A;&#x8BFB;&#x5230;&#x6CA1;&#x6709;&#x5199;&#x5165;&#x7684;&#x503C;&#xFF1A;&#x53EA;&#x6709;&#x8BFB;&#x548C;&#x5199;&#x4E24;&#x4E2A;&#x64CD;&#x4F5C;&#x662F;&#x539F;&#x5B50;&#x7684;&#xFF0C;&#x50CF;x++&#x3001;x+=2&#x8FD9;&#x79CD;&#x8868;&#x8FBE;&#x5F0F;&#x8FD8;&#x662F;&#x76F8;&#x5F53;&#x4E8E;&#x5148;&#x8BFB;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5199;&#xFF0C;&#x4E24;&#x6B21;&#x8FDB;&#x884C;&#xFF0C;&#x53EF;&#x4EE5;&#x8BFB;&#x5230;&#x4E2D;&#x95F4;&#x7684;&#x503C;&#x3002;&#x5373;&#x4F7F;&#x662F;x=2&#x8FD9;&#x6837;&#x7684;&#x8D4B;&#x503C;&#x64CD;&#x4F5C;&#xFF0C;JVM&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;long,double&#x8FD9;&#x79CD;64&#x4F4D;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF08;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x9664;&#x5916;&#xFF0C;&#x5B83;&#x7684;&#x8BFB;&#x5199;&#x59CB;&#x7EC8;&#x90FD;&#x662F;&#x539F;&#x5B50;&#x7684;&#xFF09;&#x8BFB;&#x5199;&#x7684;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x9700;&#x8981;&#x7A0B;&#x5E8F;&#x81EA;&#x5DF1;&#x63A7;&#x5236;&#x3002;&#x53E6;&#x5916;&#x8FC7;synchronized&#x548C;Lock&#x4E5F;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;&#xFF0C;synchronized&#x548C;Lock&#x80FD;&#x4FDD;&#x8BC1;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x9501;&#x7136;&#x540E;&#x6267;&#x884C;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x91CA;&#x653E;&#x9501;&#x4E4B;&#x524D;&#x4F1A;&#x5C06;&#x5BF9;&#x53D8;&#x91CF;&#x7684;&#x4FEE;&#x6539;&#x5237;&#x65B0;&#x5230;&#x4E3B;&#x5B58;&#x5F53;&#x4E2D;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;&#x3002;<blockquote>
<p>Some implementations may find it convenient to divide a single write action on a 64-bit long or double value into two write actions on adjacent 32 bit values. For efficiency&#x2019;s sake, this behavior is implementation specific; Java virtual machines are free to perform writes to long and double values atomically or in two parts.<br>For the purposes of the Java programming language memory model, a single write to a non-volatile long or double value is treated as two separate writes: one to each 32-bit half. This can result in a situation where a thread sees the first 32 bits of a 64 bit value from one write, and the second 32 bits from another write. Writes and reads of volatile long and double values are always atomic. Writes to and reads of references are always atomic, regardless of whether they are implemented as 32 or 64 bit values.<br>VM implementers are encouraged to avoid splitting their 64-bit values where possible. Programmers are encouraged to declare shared 64-bit values as volatile or synchronize their programs correctly to avoid possible complications.<br>&#x2014;&#x2014; from JLS section 17.7: Non-atomic Treatment of double and long</p>
</blockquote>
</li>
</ul>
<ul>
<li>&#x7981;&#x6B62;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x5E8F;&#xFF0C;&#x5BF9;&#x6240;&#x6709;&#x7684;volatile&#x7684;&#x53D8;&#x91CF;&#x7684;&#x6240;&#x6709;&#x6B21;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x7684;&#x5168;&#x5E8F;&#x5173;&#x7CFB;&#x3002;&#x5168;&#x5E8F;&#x5173;&#x7CFB;&#x7684;&#x610F;&#x601D;&#x662F;&#xFF1A;&#x4EFB;&#x4F55;&#x4E24;&#x4E2A;&#x64CD;&#x4F5C;&#x4E4B;&#x95F4;&#x90FD;&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x5148;&#x540E;&#x5173;&#x7CFB;&#x3002;&#x8FD9;&#x4E2A;&#x5168;&#x5E8F;&#x5173;&#x7CFB;&#x53EB;&#x201C;&#x540C;&#x6B65;&#x987A;&#x5E8F;&#x201D;(synchronization order)&#x3002;&#x8FD9;&#x4E2A;&#x540C;&#x6B65;&#x987A;&#x5E8F;&#x548C;&#x201C;&#x7A0B;&#x5E8F;&#x987A;&#x5E8F;&#x201D;(program order&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5355;&#x4E2A;&#x7EBF;&#x7A0B;&#x91CC;&#x5404;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x987A;&#x5E8F;)&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x987A;&#x5E8F;&#xFF0C;&#x6BCF;&#x6B21;&#x8BFB;&#x64CD;&#x4F5C;&#xFF0C;&#x770B;&#x5230;&#x7684;&#x4E00;&#x5B9A;&#x662F;&#x5B83;&#x4E4B;&#x524D;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x5199;&#x7684;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x4E4B;&#x524D;&#x6CA1;&#x6709;&#x5BF9;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x8BFB;&#x5230;&#x521D;&#x59CB;&#x503C;&#xFF08;0&#x3001;null&#x3001;false&#xFF09;&#x3002;&#x8FD9;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x95EE;&#x9898;&#x3002;</li>
</ul>
<p>&#x603B;&#x4E4B;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x52A0;&#x4E0A;volatile&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7981;&#x6B62;&#x8BED;&#x53E5;2,3&#x7684;&#x91CD;&#x6392;&#x5E8F;&#xFF0C;&#x4E5F;&#x5C31;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x591A;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;<br>&#x65E2;&#x7136;&#x8C08;&#x5230;&#x4E86;volatile&#xFF0C;&#x5B83;&#x9664;&#x4E86;&#x53CC;&#x91CD;&#x68C0;&#x67E5;&#x9501;&#x5B9A;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7528;&#x9014;,&#x5982;&#xFF1A;&#x72B6;&#x6001;&#x6807;&#x8BB0;&#x91CF;<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span>(!flag){</span><br><span class="line">    doSomething();</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">()</span> </span>{</span><br><span class="line">    flag = <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x5176;&#x4ED6;&#x7684;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x9605;&#x8BFB;&#xFF1A;<a href="http://www.ibm.com/developerworks/cn/java/j-jtp06197.html" target="_blank" rel="external">Java &#x7406;&#x8BBA;&#x4E0E;&#x5B9E;&#x8DF5;: &#x6B63;&#x786E;&#x4F7F;&#x7528; Volatile &#x53D8;&#x91CF;</a></p>
<h1 id="Other-Way"><a href="#Other-Way" class="headerlink" title="Other Way?"></a>Other Way?</h1><p>&#x2003;&#x2003;&#x5F53;&#x4FEE;&#x590D;&#x4E86;&#x591A;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x540E;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x8BF4;&#x4E0A;&#x8FF0;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x73B0;&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x4E0D;&#x662F;&#x7684;&#xFF0C;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;<br>(PS: &#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x88AB;&#x6210;&#x4E3A;Lazy initialization)</p>
<h2 id="Eager-initialization"><a href="#Eager-initialization" class="headerlink" title="Eager initialization"></a>Eager initialization</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>{}</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5728;&#x7C7B;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;static&#x53D8;&#x91CF;&#x4E5F;&#x4F1A;&#x88AB;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5E76;&#x4E14;JVM&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x5373;static&#x90E8;&#x5206;&#x53EA;&#x4F1A;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x6B21;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x6709;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x540E;&#x624D;&#x80FD;&#x88AB;&#x672C;&#x7EBF;&#x7A0B;&#x6216;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4F7F;&#x7528;&#x3002;&#xFF08;final&#x57DF;&#x7684;&#x5BF9;&#x8C61;&#x5177;&#x5907;&#x521D;&#x59CB;&#x5316;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x5B89;&#x5168;&#x6027;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x5BF9;&#x8C61;&#x7684;&#x521D;&#x59CB;&#x5F15;&#x7528;&#x88AB;&#x91CD;&#x6392;&#x5E8F;&#x5230;&#x7ED9;&#x6784;&#x9020;&#x8FC7;&#x7A0B;&#x4E4B;&#x524D;&#x3002;&#x5E76;&#x4E14;&#x4FDD;&#x8BC1;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x90FD;&#x80FD;&#x770B;&#x7531;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E3A;final&#x57DF;&#x8BBE;&#x7F6E;&#x7684;&#x6B63;&#x786E;&#x503C;&#xFF09;</p>
<h2 id="Initialization-on-demand-holder-idiom"><a href="#Initialization-on-demand-holder-idiom" class="headerlink" title="Initialization-on-demand holder idiom"></a>Initialization-on-demand holder idiom</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>{ }</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Initializes singleton.</span><br><span class="line">     *</span><br><span class="line">     * {<span class="doctag">@link</span> SingletonHolder} is loaded on the first execution of {<span class="doctag">@link</span> Singleton#getInstance()} or the first access to</span><br><span class="line">     * {<span class="doctag">@link</span> SingletonHolder#INSTANCE}, not before.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>{</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5BF9;&#x4E8E;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;SingletonHolder&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x5728;Singleton&#x521D;&#x59CB;&#x5316;&#x65F6;&#x5C31;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x53EA;&#x6709;SingletonHolder&#x88AB;&#x7B2C;&#x4E00;&#x6B21;&#x4F7F;&#x7528;&#x65F6;&#x5373;getInstance()&#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;INSTANCE&#x624D;&#x4F1A;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<h2 id="The-enum-way"><a href="#The-enum-way" class="headerlink" title="The enum way"></a>The enum way</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton {</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span> <span class="params">(String arg)</span> </span>{</span><br><span class="line">        <span class="comment">// Perform operation here </span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x300A;Effective Java&#x300B;&#x4E00;&#x4E66;&#x4E2D;&#x5EFA;&#x8BAE;&#x7684;&#x5B9E;&#x73B0;Singleton&#x7684;&#x6700;&#x4F73;&#x65B9;&#x6CD5;</p>
<h1 id="&#x53C2;&#x8003;&#x6587;&#x732E;"><a href="#&#x53C2;&#x8003;&#x6587;&#x732E;" class="headerlink" title="&#x53C2;&#x8003;&#x6587;&#x732E;"></a>&#x53C2;&#x8003;&#x6587;&#x732E;</h1><blockquote>
<ol>
<li><a href="https://en.wikipedia.org/wiki/Singleton_pattern" target="_blank" rel="external">Singleton pattern</a></li>
<li><a href="http://ifeve.com/double-checked-locking-with-delay-initialization/" target="_blank" rel="external">&#x53CC;&#x91CD;&#x68C0;&#x67E5;&#x9501;&#x5B9A;&#x4E0E;&#x5EF6;&#x8FDF;&#x521D;&#x59CB;&#x5316;</a></li>
<li><a href="https://bbs.byr.cn/#!article/Java/39220" target="_blank" rel="external">&#x6B6A;&#x697C;&#x7684;volatile</a></li>
<li><a href="http://www.cnblogs.com/dolphin0520/p/3920373.html" target="_blank" rel="external">Java&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#xFF1A;volatile&#x5173;&#x952E;&#x5B57;&#x89E3;&#x6790;</a></li>
</ol>
</blockquote>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://zongwenlong.github.io/2016/06/01/并发编程(1)-从单例模式说起/" data-id="cj0ayhns3001ob4uzmnganx5w" class="article-share-link">分享到</a><div class="tags"><a href="/tags/设计模式/">设计模式</a><a href="/tags/并发/">并发</a><a href="/tags/多线程/">多线程</a></div><div class="post-nav"><a href="/2016/09/03/西藏游记（六人七天）/" class="pre">西藏游记（六人七天）</a><a href="/2016/05/25/Little-Tips/" class="next">Little Tips（持续更新）</a></div><div data-thread-key="2016/06/01/并发编程(1)-从单例模式说起/" data-title="并发编程(1)-单例模式和volatile" data-url="http://zongwenlong.github.io/2016/06/01/并发编程(1)-从单例模式说起/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/06/01/并发编程(1)-从单例模式说起/" data-title="并发编程(1)-单例模式和volatile" data-url="http://zongwenlong.github.io/2016/06/01/并发编程(1)-从单例模式说起/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Technology/">Technology</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/源码阅读/" style="font-size: 15px;">源码阅读</a> <a href="/tags/Sort/" style="font-size: 15px;">Sort</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Cache/" style="font-size: 15px;">Cache</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/RESTful/" style="font-size: 15px;">RESTful</a> <a href="/tags/并发/" style="font-size: 15px;">并发</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/WordPress/" style="font-size: 15px;">WordPress</a> <a href="/tags/容器/" style="font-size: 15px;">容器</a> <a href="/tags/团队分享/" style="font-size: 15px;">团队分享</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/动态规划/" style="font-size: 15px;">动态规划</a> <a href="/tags/图搜索/" style="font-size: 15px;">图搜索</a> <a href="/tags/西藏/" style="font-size: 15px;">西藏</a> <a href="/tags/旅游/" style="font-size: 15px;">旅游</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/MilddlewareRace/">阿里巴巴中间件性能挑战赛-设计简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/26/ReadingNotes-JavaConcurrencyInPractice/">读书笔记-《Java并发编程实战》</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/06/Java-SourceCode-Sort/">Java源码阅读-DualPivotQuicksort</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/23/Docker-常用命令/">Docker 常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/07/利用Docker快速搭建WordPress博客/">利用Docker快速搭建WordPress博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/18/RESTful-SpringMVC-Swagger-Demo/">RESTful SpringMVC Swagger Demo</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/03/西藏游记（六人七天）/">西藏游记（六人七天）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/01/并发编程(1)-从单例模式说起/">并发编程(1)-单例模式和volatile</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/25/Little-Tips/">Little Tips（持续更新）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/22/动态规划/">动态规划——由实践总结经验</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/ZongWenlong" title="GitHub" target="_blank">GitHub</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">All is well.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'zongwenlong'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-77720589-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?28aa9a092a9c1d26ba2a3b5d6f2c7c60";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>